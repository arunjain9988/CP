{"task_url":"https://www.codechef.com/JULY20B/problems/LCMCONST","statement":{"HTML":{"html":"\n<html>\n\t<head>\n\t\t<link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/3.0.1/github-markdown.min.css\">\n\t\t<script type=\"text/x-mathjax-config\">\n\t\t\tMathJax.Hub.Config({\n\t\t\t\ttex2jax: {inlineMath: [['$','$']]}\n\t\t\t});\n\t\t</script>\n\t\t<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>\n\t\t<style>\n\t\t\t.markdown-body {\n\t\t\t\tbackground-color: white;\n\t\t\t\tpadding-bottom: 20px;\n\t\t\t}\n\t\t\t.markdown-body code {\n\t\t\t\tcolor: #24292e;\n\t\t\t}\n\t\t\t.solution-visible-txt {\n\t\t\t\tdisplay: none;\n\t\t\t}\n\t\t</style>\n\t</head>\n\t<body class=\"markdown-body\">\n\t\t<h1>LCM Constraints</h1>\n<h3>Read problem statements in <a href=\"http://www.codechef.com/download/translated/JULY20/hindi/LCMCONST.pdf\">Hindi</a>, <a href=\"http://www.codechef.com/download/translated/JULY20/bengali/LCMCONST.pdf\">Bengali</a>, <a href=\"http://www.codechef.com/download/translated/JULY20/mandarin/LCMCONST.pdf\">Mandarin Chinese</a>, <a href=\"http://www.codechef.com/download/translated/JULY20/russian/LCMCONST.pdf\">Russian</a>, and <a href=\"http://www.codechef.com/download/translated/JULY20/vietnamese/LCMCONST.pdf\">Vietnamese</a> as well.</h3>\n<p>You are given $M$ triplets $(X_1, Y_1, B_1), (X_2, Y_2, B_2), \\ldots, (X_M, Y_M, B_M)$. Find the number of sequences of positive integers $A_1, A_2, \\ldots, A_N$ such that for each valid $i$, $\\mathrm{lcm}(A_{X_i},A_{Y_i}) = B_i$, or determine that there is an infinite number of such sequences.</p>\n<p>Since the answer can be very large, compute it modulo $1,000,000,007$ ($10^9 + 7$). Note that the values $B_1, B_2, \\ldots, B_M$ can also be very large ― you are given their prime decompositions.</p>\n<h3>Input</h3>\n<ul>\n<li>The first line of the input contains a single integer $T$ denoting the number of test cases. The description of $T$ test cases follows.</li>\n<li>The first line of each test case contains two space-separated integers $N$ and $M$.</li>\n<li>$M$ lines follow. For each $i$ ($1 \\le i \\le M$), the $i$-th of these lines contains three space-separated integers $X_i$, $Y_i$ and $R_i$, followed by a space and $2R_i$ space-separated integers $p_1, e_1, p_2, e_2, \\ldots, p_{R_i}, e_{R_i}$, denoting that $B_i = \\prod_{r=1}^{R_i} p_r^{e_r}$.</li>\n</ul>\n<h3>Output</h3>\n<p>For each test case, print a single line containing one integer ― the number of valid sequences modulo $1,000,000,007$, or $-1$ if there are infinitely many valid sequences.</p>\n<h3>Constraints</h3>\n<ul>\n<li>$1 \\le T \\le 3$</li>\n<li>$0 \\le M \\le 10^4$</li>\n<li>$1 \\le N \\le 38$</li>\n<li>$1 \\le X_i, Y_i \\le N$ for each valid $i$</li>\n<li>$0 \\le R_i \\le 200$ for each valid $i$</li>\n<li>$p_r$ is a prime for each valid $r$</li>\n<li>$p_r \\le 10^6$ for each valid $r$</li>\n<li>the total number of different primes $p_r$ in each test case does not exceed $5$</li>\n<li>$1 \\le e_r \\le 10^6$ for each valid $r$</li>\n</ul>\n<h3>Subtasks</h3>\n<p><strong>Subtask #1 (20 points, time limit 2 seconds):</strong> $N \\le 20$</p>\n<p><strong>Subtask #2 (35 points, time limit 4 seconds):</strong> $N \\le 30$</p>\n<p><strong>Subtask #3 (45 points, time limit 4.5 seconds):</strong> $T = 1$</p>\n<h3>Example Input</h3>\n<pre><code>3\n2 0\n2 2\n1 2 0\n2 1 0\n2 2\n1 2 0\n2 1 1 2 1\n</code></pre>\n<h3>Example Output</h3>\n<pre><code>-1\n1\n0\n</code></pre>\n<h3>Explanation</h3>\n<p><strong>Example case 1:</strong> Both elements of $A$ can be any positive integers, so there is an infinite number of valid sequences.</p>\n<p><strong>Example case 2:</strong> There are two constraints, but they are actually identical: $\\mathrm{lcm}(A_1, A_2) = 1$. The only sequence that satisfies this is $A = [1, 1]$.</p>\n<p><strong>Example case 3:</strong> The two constraints contradict each other, so there is no valid sequence.</p>\n\n\t<body>\n</html>"}}}