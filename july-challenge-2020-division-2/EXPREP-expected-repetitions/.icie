{"task_url":"https://www.codechef.com/JULY20B/problems/EXPREP","statement":{"HTML":{"html":"\n<html>\n\t<head>\n\t\t<link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/3.0.1/github-markdown.min.css\">\n\t\t<script type=\"text/x-mathjax-config\">\n\t\t\tMathJax.Hub.Config({\n\t\t\t\ttex2jax: {inlineMath: [['$','$']]}\n\t\t\t});\n\t\t</script>\n\t\t<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>\n\t\t<style>\n\t\t\t.markdown-body {\n\t\t\t\tbackground-color: white;\n\t\t\t\tpadding-bottom: 20px;\n\t\t\t}\n\t\t\t.markdown-body code {\n\t\t\t\tcolor: #24292e;\n\t\t\t}\n\t\t\t.solution-visible-txt {\n\t\t\t\tdisplay: none;\n\t\t\t}\n\t\t</style>\n\t</head>\n\t<body class=\"markdown-body\">\n\t\t<h1>Expected Repetitions</h1>\n<h3>Read problem statements in <a href=\"http://www.codechef.com/download/translated/JULY20/hindi/EXPREP.pdf\">Hindi</a>.</h3>\n<p>You are given a string $S$ with length $N$ that contains only the $26$ lowercase English letters. You are also given a sequence $W_1, W_2, \\ldots, W_{26}$ of weights corresponding to these letters in the order from 'a' to 'z', i.e. $W_1$ is the weight of 'a', $W_2$ is the weight of 'b' and so on.</p>\n<p>We define the <em>weight</em> of a string as the sum of weights of all characters present in it. If a character occurs multiple times in this string, its weight is also counted multiple times.</p>\n<p>Next, we define the <em>power</em> of a string $s$ as the sum of weights of all strings $r$ such that $s$ can be represented as $r + r + \\ldots + r + p$, where $+$ denotes string concatenation and $p$ is a prefix of $r$ (possibly empty).</p>\n<p>Consider a contiguous substring of $S$ chosen uniformly randomly among all its $N(N+1)/2$ contiguous substrings. Find the expected value of the power of such a substring. The expected power can be represented as a fraction $P / Q$, where $P$ and $Q$ are positive integers and $Q$ is coprime with $998,244,353$. You should calculate $P \\cdot Q^{-1}$ modulo $998,244,353$, where $Q^{-1}$ denotes the multiplicative inverse of $Q$ modulo $998,244,353$.</p>\n<h3>Input</h3>\n<ul>\n<li>The first line of the input contains a single integer $T$ denoting the number of test cases. The description of $T$ test cases follows.</li>\n<li>The first line of each test case contains a single string $S$.</li>\n<li>The second line contains $26$ space-separated integers $W_1, W_2, \\ldots, W_{26}$.</li>\n</ul>\n<h3>Output</h3>\n<p>For each test case, print a single line containing one integer $P \\cdot Q^{-1}$ modulo $998,244,353$.</p>\n<h3>Constraints</h3>\n<ul>\n<li>$1 \\le N \\le 500,000$</li>\n<li>$1 \\le W_i \\le 10^9$ for each valid $i$</li>\n<li>$S$ contains only lowercase English letters</li>\n<li>the sum of $|S|$ over all test cases does not exceed $500,000$</li>\n</ul>\n<h3>Subtasks</h3>\n<p><strong>Subtask #1 (10 points):</strong></p>\n<ul>\n<li>$N \\le 100$</li>\n<li>the sum of $|S|$ over all test cases does not exceed $1,000$</li>\n</ul>\n<p><strong>Subtask #2 (20 points):</strong></p>\n<ul>\n<li>$N \\le 2,000$</li>\n<li>the sum of $|S|$ over all test cases does not exceed $20,000$</li>\n</ul>\n<p><strong>Subtask #3 (70 points):</strong> original constraints</p>\n<h3>Example Input</h3>\n<pre><code>2\naaa\n1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1\nabab\n1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1\n</code></pre>\n<h3>Example Output</h3>\n<pre><code>499122179\n698771051\n</code></pre>\n<h3>Explanation</h3>\n<p>Let $W(s)$ and $P(s)$ denote the weight and power of a string $s$ respectively.</p>\n<p><strong>Example case 1:</strong> There are $3$ contiguous substrings &quot;a&quot;, $2$ contiguous substrings &quot;aa&quot; and $1$ contiguous substring &quot;aaa&quot;.</p>\n<ul>\n<li>&quot;a&quot; is chosen with probability $3/6$; we have $P(\\mathrm{a}) = W(\\mathrm{a}) = 1$</li>\n<li>&quot;aa&quot; is chosen with probability $2/6$; $P(\\mathrm{aa}) = W(\\mathrm{a}) + W(\\mathrm{aa}) = 1 + 2 = 3$</li>\n<li>&quot;aaa&quot; is chosen with probability $1/6$; $P(\\mathrm{aaa}) = W(\\mathrm{a}) + W(\\mathrm{aa}) + W(\\mathrm{aaa}) = 1 + 2 + 3 = 6$</li>\n</ul>\n<p>The expected power is $(3 \\cdot 1 + 2 \\cdot 3 + 1 \\cdot 6) / 6 = 15 / 6$.</p>\n<p><strong>Example case 2:</strong> The contiguous substrings are &quot;a&quot;, &quot;b&quot;, &quot;ab&quot;, &quot;ba&quot;, &quot;aba&quot;, &quot;bab&quot;, &quot;abab&quot;; the first three of them occur twice. We have $P(\\mathrm{a}) = W(\\mathrm{a}) = 1$, $P(\\mathrm{b}) = W(\\mathrm{b}) = 2$, $P(\\mathrm{ab}) = W(\\mathrm{ab}) = 1 + 2 = 3$, $P(\\mathrm{ba}) = W(\\mathrm{ba}) = 3$, $P(\\mathrm{aba}) = W(\\mathrm{ab}) + W(\\mathrm{aba}) = 3 + 4 = 7$, $P(\\mathrm{bab}) = W(\\mathrm{ba}) + W(\\mathrm{bab}) = 3 + 5 = 8$ and $P(\\mathrm{abab}) = W(\\mathrm{ab}) + W(\\mathrm{abab}) = 3 + 6 = 9$.</p>\n<p>The expected power is $(2 \\cdot P(\\mathrm{a}) + 2 \\cdot P(\\mathrm{b}) + 2 \\cdot P(\\mathrm{ab}) + P(\\mathrm{ba}) + P(\\mathrm{aba}) + P(\\mathrm{bab}) + P(\\mathrm{abab})) / 10 = 39 / 10$.</p>\n\n\t<body>\n</html>"}}}